function InfinityScroll(t,i){t&&(this.isCatched=!1,this.config=Object.assign(new InfinityScroll.Config,i||{}),this._elm=this._catchElm(t),this._map=new InfinityScroll.Map(this._elm,this.config),this._overlay=new InfinityScroll.Overlay(this),this._inertionState=new InfinityScroll.InertionState(this),this._catchFn=this._catchUnbindedFn(),this._uncatch=this._uncatchUnbindedFn(),this._move=this._moveUnbindedFn(),this._tempMousePosX=void 0,this._tempMousePosY=void 0,this.initListeners())}InfinityScroll.prototype._moveUnbindedFn=function(){var i=this;return function(t){i.isCatched&&(i.config.inertia&&i._inertionState.updateStartPos(t),"mousemove"===t.type&&(i.moveTo(t.clientX-i._tempMousePosX,t.clientY-i._tempMousePosY),i._tempMousePosX=t.clientX,i._tempMousePosY=t.clientY),"touchmove"===t.type&&(i.moveTo(t.touches[0].clientX-i._tempMousePosX,t.touches[0].clientY-i._tempMousePosY),i._tempMousePosX=t.touches[0].clientX,i._tempMousePosY=t.touches[0].clientY))}},InfinityScroll.prototype._uncatchUnbindedFn=function(){var i=this;return function(t){i.isCatched=!1,i._tempMousePosX=void 0,i._tempMousePosY=void 0,i.config.inertia&&(i._inertionState.updateImpulses(t),i._inertionState.inertionMove())}},InfinityScroll.prototype.initListeners=function(){this._addMouseListeners()},InfinityScroll.prototype.moveTo=function(t,i){this.config.axisX&&this._map.setPosX(t),this.config.axisY&&this._map.setPosY(i)},InfinityScroll.prototype._catchElm=function(t){var i;if(t instanceof HTMLElement?i=t:"string"==typeof t&&(i=document.querySelector(t)),!i)throw new Error('Wrong type of argument "selector"');return i},InfinityScroll.prototype.destroy=function(){this._map.screenElm.removeEventListener("mousedown",this._catchFn),this._map.screenElm.removeEventListener("mousemove",this._move),this._map.screenElm.removeEventListener("mouseup",this._uncatch),this._map.screenElm.removeEventListener("touchstart",this._catchFn)},InfinityScroll.prototype._addMouseListeners=function(){this._map.screenElm.addEventListener("mousedown",this._catchFn),this._map.screenElm.addEventListener("mousemove",this._move),this._map.screenElm.addEventListener("mouseup",this._uncatch),this._map.screenElm.addEventListener("touchstart",this._catchFn)},InfinityScroll.prototype._catchUnbindedFn=function(){var i=this;return function(t){i.isCatched=!0}},InfinityScroll.Config=function(){this.triggerMenuAttributeSelector="data-infinity-scroll",this.inertia=!0,this.axisX=!0,this.axisY=!0},InfinityScroll.InertionState=function(t){this._impulseX=0,this._impulseY=0,this._screen=t,this._startX=void 0,this._startY=void 0,this._readyToUpdatePos=!0},InfinityScroll.InertionState.prototype.updateImpulses=function(t){self._readyToUpdatePos=!1;var i=performance.now()-this._startDragTime,e=(t.clientX-this._startX)/i,s=(t.clientY-this._startY)/i;this._impulseX=50*e,this._impulseY=50*s},InfinityScroll.InertionState.prototype.updateStartPos=function(t){var i=this;this._readyToUpdatePos&&(i._readyToUpdatePos=!1,this._startX=t.clientX,this._startY=t.clientY,this._startDragTime=performance.now(),setTimeout(function(){i._readyToUpdatePos=!0},100))},InfinityScroll.InertionState.prototype.inertionMove=function(){if(!this._screen.isCatched){var t=this,i=this._impulseX-this._impulseX/40,e=this._impulseY-this._impulseY/40;.1<Math.abs(this._impulseX-e)&&.1<Math.abs(this._impulseY-i)&&setTimeout(function(){t._screen.moveTo(i,e),t._impulseX=i,t._impulseY=e,t.inertionMove(i,e)},16)}},InfinityScroll.Overlay=function(t){this._scroll=t,this.isShowed=!1,this._elm=document.createElement("div"),this._tempMousePosX=void 0,this._tempMousePosY=void 0,this._uncatchFn=this._uncatchUnbindedFn(),this._move=this._moveUnbindedFn(),this.init()},InfinityScroll.Overlay.prototype.init=function(){var t=this._elm;t.style.position="fixed",t.style["z-index"]=1e4,t.style.display="none",t.style.height="100%",t.style.width="100%",t.style.top="0",t.style.left="0",t.style.cursor="move",this.initListeners(),document.body.appendChild(t)},InfinityScroll.Overlay.prototype.initListeners=function(){this._elm.addEventListener("mouseup",this._uncatchFn)},InfinityScroll.Overlay.prototype.hide=function(){this.isShowed&&(this._elm.style.display="none",document.body.style["user-select"]=null,this.isShowed=!1)},InfinityScroll.Overlay.prototype.show=function(){this.isShowed||(this._elm.style.display="block",document.body.style["user-select"]="none",this.isShowed=!0)},InfinityScroll.Overlay.prototype._uncatchUnbindedFn=function(){var t=this;return function(){t._scroll.isCatched=!1,t._tempMousePosX=void 0,t._tempMousePosY=void 0,t.hide()}},InfinityScroll.Overlay.prototype._moveUnbindedFn=function(){var i=this;return function(t){i.isShowed&&("mousemove"===t.type&&(i._scroll.moveTo(t.clientX-i._tempMousePosX,t.clientY-i._tempMousePosY),i._tempMousePosX=t.clientX,i._tempMousePosY=t.clientY),"touchmove"===t.type&&(i._scroll.moveTo(t.touches[0].clientX-i._tempMousePosX,t.touches[0].clientY-i._tempMousePosY),i._tempMousePosX=t.touches[0].clientX,i._tempMousePosY=t.touches[0].clientY))}},InfinityScroll.Map=function(t,i){this.width=void 0,this.height=void 0,this.posX=void 0,this.posY=void 0,this.elm=void 0,this._copies=[],this.config=i,this.screenElm=t,this.resizeFn=this.resizeUnbindedFn(),this.updateSizes(),this.init()},InfinityScroll.Map.prototype.initListeners=function(){window.addEventListener("resize",this.resizeFn)},InfinityScroll.Map.prototype.updateSizes=function(){var t=this.screenElm.getBoundingClientRect();this.width=t.width,this.height=t.height,this.posX=-t.width,this.posY=-t.height},InfinityScroll.Map.prototype.resizeUnbindedFn=function(){var i=this,e=InfinityScroll.Map.toPx,s=!1;return function(t){s||(s=!0,setTimeout(function(){s=!1,i.updateSizes(),i.setState(),i._copies.forEach(function(t){t.style.width=e(i.width),t.style.height=e(i.height)})},100))}},InfinityScroll.Map.prototype.setPosX=function(t){!isNaN(t)&&this.config.axisX&&(this.posX=this.posX+t,this.posX=this.posX<0?this.posX:-this.width,this.posX=0-2*this.width<this.posX?this.posX:-this.width,this.elm.style.left=InfinityScroll.Map.toPx(this.posX))},InfinityScroll.Map.prototype.setPosY=function(t){!isNaN(t)&&this.config.axisY&&(this.posY=this.posY+t,this.posY=this.posY<0?this.posY:-this.height,this.posY=0-2*this.height<this.posY?this.posY:-this.height,this.elm.style.top=InfinityScroll.Map.toPx(this.posY))},InfinityScroll.Map.prototype.init=function(){var t=InfinityScroll.Map.toPx,i=1;this.config.axisX&&(i*=3),this.config.axisY&&(i*=3),this.elm=document.createElement("div"),this.elm.classList.add("map"),this.elm.style["user-select"]="none";for(var e=0;e<i;e++){var s=this.screenElm.cloneNode(!0);s.style.float="left",s.style.width=t(this.width),s.style.height=t(this.height),this.elm.appendChild(s),this._copies.push(s)}this.screenElm.innerHTML="",this.screenElm.style.position="relative",this.screenElm.style.overflow="hidden",this.elm.style.position="absolute",this.setState(),this.initListeners(),this.screenElm.appendChild(this.elm)},InfinityScroll.Map.prototype.setState=function(){var t=InfinityScroll.Map.toPx;this.config.axisY&&(this.elm.style.height=t(this.height*(this.config.axisY?3:1)),this.elm.style.top=t(this.posY)),this.config.axisX&&(this.elm.style.width=t(this.width*(this.config.axisX?3:1)),this.elm.style.left=t(this.posX))},InfinityScroll.Map.toPx=function(t){return t+"px"};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZmluaXR5LXNjcmVlbi5qcyIsImluZmluaXR5LXNjcmVlbi5jb25maWcuanMiLCJpbmZpbml0eS1zY3JlZW4uaW5lcnRpb24tc3RhdGUuanMiLCJpbmZpbml0eS1zY3JlZW4ub3ZlcmxheS5qcyIsImluZmluaXR5LXNjcmVlbi5tYXAuanMiXSwibmFtZXMiOlsiSW5maW5pdHlTY3JvbGwiLCJlbG0iLCJjb25maWciLCJ0aGlzIiwiaXNDYXRjaGVkIiwiT2JqZWN0IiwiYXNzaWduIiwiQ29uZmlnIiwiX2VsbSIsIl9jYXRjaEVsbSIsIl9tYXAiLCJNYXAiLCJfb3ZlcmxheSIsIk92ZXJsYXkiLCJfaW5lcnRpb25TdGF0ZSIsIkluZXJ0aW9uU3RhdGUiLCJfY2F0Y2hGbiIsIl9jYXRjaFVuYmluZGVkRm4iLCJfdW5jYXRjaCIsIl91bmNhdGNoVW5iaW5kZWRGbiIsIl9tb3ZlIiwiX21vdmVVbmJpbmRlZEZuIiwiX3RlbXBNb3VzZVBvc1giLCJ1bmRlZmluZWQiLCJfdGVtcE1vdXNlUG9zWSIsImluaXRMaXN0ZW5lcnMiLCJwcm90b3R5cGUiLCJzZWxmIiwiZSIsImluZXJ0aWEiLCJ1cGRhdGVTdGFydFBvcyIsInR5cGUiLCJtb3ZlVG8iLCJjbGllbnRYIiwiY2xpZW50WSIsInRvdWNoZXMiLCJ1cGRhdGVJbXB1bHNlcyIsImluZXJ0aW9uTW92ZSIsIl9hZGRNb3VzZUxpc3RlbmVycyIsIngiLCJ5IiwiYXhpc1giLCJzZXRQb3NYIiwiYXhpc1kiLCJzZXRQb3NZIiwic2VsZWN0b3IiLCJIVE1MRWxlbWVudCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIkVycm9yIiwiZGVzdHJveSIsInNjcmVlbkVsbSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwidHJpZ2dlck1lbnVBdHRyaWJ1dGVTZWxlY3RvciIsInNjcmVlbiIsIl9pbXB1bHNlWCIsIl9pbXB1bHNlWSIsIl9zY3JlZW4iLCJfc3RhcnRYIiwiX3N0YXJ0WSIsIl9yZWFkeVRvVXBkYXRlUG9zIiwibW92ZVRpbWUiLCJwZXJmb3JtYW5jZSIsIm5vdyIsIl9zdGFydERyYWdUaW1lIiwic3BlZWRYIiwic3BlZWRZIiwic2V0VGltZW91dCIsInRtcEltcFgiLCJ0bXBJbXBZIiwiTWF0aCIsImFicyIsInNjcm9sbCIsIl9zY3JvbGwiLCJpc1Nob3dlZCIsImNyZWF0ZUVsZW1lbnQiLCJfdW5jYXRjaEZuIiwiaW5pdCIsImVsIiwic3R5bGUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJoaWRlIiwic2hvdyIsImNvbmZpZ1JlZiIsIndpZHRoIiwiaGVpZ2h0IiwicG9zWCIsInBvc1kiLCJfY29waWVzIiwicmVzaXplRm4iLCJyZXNpemVVbmJpbmRlZEZuIiwidXBkYXRlU2l6ZXMiLCJ3aW5kb3ciLCJzaXplcyIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvUHgiLCJpc0NoYW5nZWQiLCJzZXRTdGF0ZSIsImZvckVhY2giLCJjb3B5IiwiaXNOYU4iLCJuZWNlc3NhcnlDb3BpZXMiLCJjbGFzc0xpc3QiLCJhZGQiLCJpIiwiY2xvbmVOb2RlIiwicHVzaCIsImlubmVySFRNTCIsInB4Il0sIm1hcHBpbmdzIjoiQUFBQSxTQUFBQSxlQUFBQyxFQUFBQyxHQUNBRCxJQUNBRSxLQUFBQyxXQUFBLEVBQ0FELEtBQUFELE9BQUFHLE9BQUFDLE9BQUEsSUFBQU4sZUFBQU8sT0FBQUwsT0FDQUMsS0FBQUssS0FBQUwsS0FBQU0sVUFBQVIsR0FDQUUsS0FBQU8sS0FBQSxJQUFBVixlQUFBVyxJQUFBUixLQUFBSyxLQUFBTCxLQUFBRCxRQUNBQyxLQUFBUyxTQUFBLElBQUFaLGVBQUFhLFFBQUFWLE1BQ0FBLEtBQUFXLGVBQUEsSUFBQWQsZUFBQWUsY0FBQVosTUFFQUEsS0FBQWEsU0FBQWIsS0FBQWMsbUJBQ0FkLEtBQUFlLFNBQUFmLEtBQUFnQixxQkFDQWhCLEtBQUFpQixNQUFBakIsS0FBQWtCLGtCQUVBbEIsS0FBQW1CLG9CQUFBQyxFQUNBcEIsS0FBQXFCLG9CQUFBRCxFQUVBcEIs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RUFBQUEsRUFBQUgsRUFBQUcsSUFBQSxDQUNBLElBQUFMLEVBQUFsRyxLQUFBZ0QsVUFBQXdELFdBQUEsR0FDQU4sRUFBQXJCLE1BQUEsTUFBQSxPQUNBcUIsRUFBQXJCLE1BQUEsTUFBQWlCLEVBQUE5RixLQUFBbUYsT0FDQWUsRUFBQXJCLE1BQUEsT0FBQWlCLEVBQUE5RixLQUFBb0YsUUFDQXBGLEtBQUFGLElBQUFpRixZQUFBbUIsR0FDQWxHLEtBQUF1RixRQUFBa0IsS0FBQVAsR0FHQWxHLEtBQUFnRCxVQUFBMEQsVUFBQSxHQUNBMUcsS0FBQWdELFVBQUE2QixNQUFBLFNBQUEsV0FDQTdFLEtBQUFnRCxVQUFBNkIsTUFBQSxTQUFBLFNBQ0E3RSxLQUFBRixJQUFBK0UsTUFBQSxTQUFBLFdBQ0E3RSxLQUFBZ0csV0FDQWhHLEtBQUFzQixnQkFDQXRCLEtBQUFnRCxVQUFBK0IsWUFBQS9FLEtBQUFGLE1BR0FELGVBQUFXLElBQUFlLFVBQUF5RSxTQUFBLFdBQ0EsSUFBQUYsRUFBQWpHLGVBQUFXLElBQUFzRixLQUNBOUYsS0FBQUQsT0FBQXlDLFFBQ0F4QyxLQUFBRixJQUFBK0UsTUFBQSxPQUFBaUIsRUFBQTlGLEtBQUFvRixRQUFBcEYsS0FBQUQsT0FBQXlDLE1BQUEsRUFBQSxJQUNBeEMsS0FBQUYsSUFBQStFLE1BQUEsSUFBQWlCLEVBQUE5RixLQUFBc0YsT0FFQXRGLEtBQUFELE9BQUF1QyxRQUNBdEMsS0FBQUYsSUFBQStFLE1BQUEsTUFBQWlCLEVBQUE5RixLQUFBbUYsT0FBQW5GLEtBQUFELE9BQUF1QyxNQUFBLEVBQUEsSUFDQXRDLEtBQUFGLElBQUErRSxNQUFBLEtBQUFpQixFQUFBOUYsS0FBQXFGLFFBSUF4RixlQUFBVyxJQUFBc0YsS0FBQSxTQUFBYSxHQUNBLE9BQUFBLEVBQUEiLCJmaWxlIjoiaW5maW5pdHktc2NyZWVuLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIEluZmluaXR5U2Nyb2xsKGVsbSwgY29uZmlnKSB7XHJcbiAgICBpZiAoZWxtKSB7XHJcbiAgICAgICAgdGhpcy5pc0NhdGNoZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24obmV3IEluZmluaXR5U2Nyb2xsLkNvbmZpZywgY29uZmlnIHx8IHt9KTtcclxuICAgICAgICB0aGlzLl9lbG0gPSB0aGlzLl9jYXRjaEVsbShlbG0pO1xyXG4gICAgICAgIHRoaXMuX21hcCA9IG5ldyBJbmZpbml0eVNjcm9sbC5NYXAodGhpcy5fZWxtLCB0aGlzLmNvbmZpZyk7XHJcbiAgICAgICAgdGhpcy5fb3ZlcmxheSA9IG5ldyBJbmZpbml0eVNjcm9sbC5PdmVybGF5KHRoaXMpO1xyXG4gICAgICAgIHRoaXMuX2luZXJ0aW9uU3RhdGUgPSBuZXcgSW5maW5pdHlTY3JvbGwuSW5lcnRpb25TdGF0ZSh0aGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy5fY2F0Y2hGbiA9IHRoaXMuX2NhdGNoVW5iaW5kZWRGbigpO1xyXG4gICAgICAgIHRoaXMuX3VuY2F0Y2ggPSB0aGlzLl91bmNhdGNoVW5iaW5kZWRGbigpO1xyXG4gICAgICAgIHRoaXMuX21vdmUgPSB0aGlzLl9tb3ZlVW5iaW5kZWRGbigpO1xyXG5cclxuICAgICAgICB0aGlzLl90ZW1wTW91c2VQb3NYID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuX3RlbXBNb3VzZVBvc1kgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdExpc3RlbmVycygpO1xyXG4gICAgfVxyXG59XHJcblxyXG5JbmZpbml0eVNjcm9sbC5wcm90b3R5cGUuX21vdmVVbmJpbmRlZEZuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKCFzZWxmLmlzQ2F0Y2hlZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBpZiAoc2VsZi5jb25maWcuaW5lcnRpYSkge1xyXG4gICAgICAgICAgICBzZWxmLl9pbmVydGlvblN0YXRlLnVwZGF0ZVN0YXJ0UG9zKGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGUudHlwZSA9PT0gJ21vdXNlbW92ZScpIHtcclxuICAgICAgICAgICAgc2VsZi5tb3ZlVG8oZS5jbGllbnRYIC0gc2VsZi5fdGVtcE1vdXNlUG9zWCwgZS5jbGllbnRZIC0gc2VsZi5fdGVtcE1vdXNlUG9zWSk7XHJcbiAgICAgICAgICAgIHNlbGYuX3RlbXBNb3VzZVBvc1ggPSBlLmNsaWVudFg7XHJcbiAgICAgICAgICAgIHNlbGYuX3RlbXBNb3VzZVBvc1kgPSBlLmNsaWVudFk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZS50eXBlID09PSAndG91Y2htb3ZlJykge1xyXG4gICAgICAgICAgICBzZWxmLm1vdmVUbyhlLnRvdWNoZXNbMF0uY2xpZW50WCAtIHNlbGYuX3RlbXBNb3VzZVBvc1gsIGUudG91Y2hlc1swXS5jbGllbnRZIC0gc2VsZi5fdGVtcE1vdXNlUG9zWSk7XHJcbiAgICAgICAgICAgIHNlbGYuX3RlbXBNb3VzZVBvc1ggPSBlLnRvdWNoZXNbMF0uY2xpZW50WDtcclxuICAgICAgICAgICAgc2VsZi5fdGVtcE1vdXNlUG9zWSA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLnByb3RvdHlwZS5fdW5jYXRjaFVuYmluZGVkRm4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBzZWxmLmlzQ2F0Y2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHNlbGYuX3RlbXBNb3VzZVBvc1ggPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgc2VsZi5fdGVtcE1vdXNlUG9zWSA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmluZXJ0aWEpIHtcclxuICAgICAgICAgICAgc2VsZi5faW5lcnRpb25TdGF0ZS51cGRhdGVJbXB1bHNlcyhlKTtcclxuICAgICAgICAgICAgc2VsZi5faW5lcnRpb25TdGF0ZS5pbmVydGlvbk1vdmUoKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwucHJvdG90eXBlLmluaXRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLl9hZGRNb3VzZUxpc3RlbmVycygpO1xyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwucHJvdG90eXBlLm1vdmVUbyA9IGZ1bmN0aW9uICh4LCB5KSB7XHJcbiAgICB0aGlzLmNvbmZpZy5heGlzWCAmJiB0aGlzLl9tYXAuc2V0UG9zWCh4KTtcclxuICAgIHRoaXMuY29uZmlnLmF4aXNZICYmIHRoaXMuX21hcC5zZXRQb3NZKHkpO1xyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwucHJvdG90eXBlLl9jYXRjaEVsbSA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xyXG4gICAgdmFyIGVsbTtcclxuICAgIGlmIChzZWxlY3RvciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgZWxtID0gc2VsZWN0b3I7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICBlbG0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWVsbSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignV3JvbmcgdHlwZSBvZiBhcmd1bWVudCBcInNlbGVjdG9yXCInKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZWxtO1xyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLl9tYXAuc2NyZWVuRWxtLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2NhdGNoRm4pO1xyXG4gICAgdGhpcy5fbWFwLnNjcmVlbkVsbS5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9tb3ZlKTtcclxuICAgIHRoaXMuX21hcC5zY3JlZW5FbG0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX3VuY2F0Y2gpO1xyXG4gICAgdGhpcy5fbWFwLnNjcmVlbkVsbS5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5fY2F0Y2hGbik7XHJcbn07XHJcblxyXG5JbmZpbml0eVNjcm9sbC5wcm90b3R5cGUuX2FkZE1vdXNlTGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5fbWFwLnNjcmVlbkVsbS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9jYXRjaEZuKTtcclxuICAgIHRoaXMuX21hcC5zY3JlZW5FbG0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fbW92ZSk7XHJcbiAgICB0aGlzLl9tYXAuc2NyZWVuRWxtLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl91bmNhdGNoKTtcclxuICAgIHRoaXMuX21hcC5zY3JlZW5FbG0uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMuX2NhdGNoRm4pO1xyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwucHJvdG90eXBlLl9jYXRjaFVuYmluZGVkRm4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBzZWxmLmlzQ2F0Y2hlZCA9IHRydWU7XHJcbiAgICB9XHJcbn07IiwiSW5maW5pdHlTY3JvbGwuQ29uZmlnID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy50cmlnZ2VyTWVudUF0dHJpYnV0ZVNlbGVjdG9yID0gJ2RhdGEtaW5maW5pdHktc2Nyb2xsJztcclxuICAgIHRoaXMuaW5lcnRpYSA9IHRydWU7XHJcbiAgICB0aGlzLmF4aXNYID0gdHJ1ZTtcclxuICAgIHRoaXMuYXhpc1kgPSB0cnVlO1xyXG59OyIsIkluZmluaXR5U2Nyb2xsLkluZXJ0aW9uU3RhdGUgPSBmdW5jdGlvbiAoc2NyZWVuKSB7XHJcbiAgICB0aGlzLl9pbXB1bHNlWCA9IDA7XHJcbiAgICB0aGlzLl9pbXB1bHNlWSA9IDA7XHJcbiAgICB0aGlzLl9zY3JlZW4gPSBzY3JlZW47XHJcbiAgICB0aGlzLl9zdGFydFggPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLl9zdGFydFkgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLl9yZWFkeVRvVXBkYXRlUG9zID0gdHJ1ZTtcclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLkluZXJ0aW9uU3RhdGUucHJvdG90eXBlLnVwZGF0ZUltcHVsc2VzID0gZnVuY3Rpb24gKGUpIHtcclxuXHJcbiAgICAgICAgc2VsZi5fcmVhZHlUb1VwZGF0ZVBvcyA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBtb3ZlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gdGhpcy5fc3RhcnREcmFnVGltZTtcclxuICAgICAgICB2YXIgZGlzdGFuY2VYID0gZS5jbGllbnRYIC0gdGhpcy5fc3RhcnRYO1xyXG4gICAgICAgIHZhciBkaXN0YW5jZVkgPSBlLmNsaWVudFkgLSB0aGlzLl9zdGFydFk7XHJcbiAgICAgICAgdmFyIHNwZWVkWCA9IGRpc3RhbmNlWCAvIG1vdmVUaW1lO1xyXG4gICAgICAgIHZhciBzcGVlZFkgPSBkaXN0YW5jZVkgLyBtb3ZlVGltZTtcclxuICAgICAgICB2YXIgbSA9IDUwO1xyXG5cclxuICAgICAgICB0aGlzLl9pbXB1bHNlWCA9IHNwZWVkWCAqIG07XHJcbiAgICAgICAgdGhpcy5faW1wdWxzZVkgPSBzcGVlZFkgKiBtO1xyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuSW5lcnRpb25TdGF0ZS5wcm90b3R5cGUudXBkYXRlU3RhcnRQb3MgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgaWYoIHRoaXMuX3JlYWR5VG9VcGRhdGVQb3MgKSB7XHJcbiAgICAgICAgc2VsZi5fcmVhZHlUb1VwZGF0ZVBvcyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX3N0YXJ0WCA9IGUuY2xpZW50WDtcclxuICAgICAgICB0aGlzLl9zdGFydFkgPSBlLmNsaWVudFk7XHJcbiAgICAgICAgdGhpcy5fc3RhcnREcmFnVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWxmLl9yZWFkeVRvVXBkYXRlUG9zID0gdHJ1ZTtcclxuICAgICAgICB9LCAxMDApO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuSW5lcnRpb25TdGF0ZS5wcm90b3R5cGUuaW5lcnRpb25Nb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKCF0aGlzLl9zY3JlZW4uaXNDYXRjaGVkKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgdG1wSW1wWCA9IHRoaXMuX2ltcHVsc2VYIC0gKHRoaXMuX2ltcHVsc2VYIC8gNDApO1xyXG4gICAgICAgIHZhciB0bXBJbXBZID0gdGhpcy5faW1wdWxzZVkgLSAodGhpcy5faW1wdWxzZVkgLyA0MCk7XHJcblxyXG4gICAgICAgIGlmIChNYXRoLmFicyh0aGlzLl9pbXB1bHNlWCAtIHRtcEltcFkpID4gLjEgJiYgTWF0aC5hYnModGhpcy5faW1wdWxzZVkgLSB0bXBJbXBYKSA+IC4xKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5fc2NyZWVuLm1vdmVUbyh0bXBJbXBYLCB0bXBJbXBZKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxmLl9pbXB1bHNlWCA9IHRtcEltcFg7XHJcbiAgICAgICAgICAgICAgICBzZWxmLl9pbXB1bHNlWSA9IHRtcEltcFk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZi5pbmVydGlvbk1vdmUodG1wSW1wWCwgdG1wSW1wWSk7XHJcbiAgICAgICAgICAgIH0sIDE2KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07IiwiSW5maW5pdHlTY3JvbGwuT3ZlcmxheSA9IGZ1bmN0aW9uIChzY3JvbGwpIHtcclxuICAgIHRoaXMuX3Njcm9sbCA9IHNjcm9sbDtcclxuICAgIHRoaXMuaXNTaG93ZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuX2VsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgdGhpcy5fdGVtcE1vdXNlUG9zWCA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuX3RlbXBNb3VzZVBvc1kgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLl91bmNhdGNoRm4gPSB0aGlzLl91bmNhdGNoVW5iaW5kZWRGbigpO1xyXG4gICAgdGhpcy5fbW92ZSA9IHRoaXMuX21vdmVVbmJpbmRlZEZuKCk7XHJcbiAgICB0aGlzLmluaXQoKTtcclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLk92ZXJsYXkucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZWwgPSB0aGlzLl9lbG07XHJcbiAgICBlbC5zdHlsZVsncG9zaXRpb24nXSA9ICdmaXhlZCc7XHJcbiAgICBlbC5zdHlsZVsnei1pbmRleCddID0gMTAwMDA7XHJcbiAgICBlbC5zdHlsZVsnZGlzcGxheSddID0gJ25vbmUnO1xyXG4gICAgZWwuc3R5bGVbJ2hlaWdodCddID0gJzEwMCUnO1xyXG4gICAgZWwuc3R5bGVbJ3dpZHRoJ10gPSAnMTAwJSc7XHJcbiAgICBlbC5zdHlsZVsndG9wJ10gPSAnMCc7XHJcbiAgICBlbC5zdHlsZVsnbGVmdCddID0gJzAnO1xyXG4gICAgZWwuc3R5bGVbJ2N1cnNvciddID0gJ21vdmUnO1xyXG4gICAgdGhpcy5pbml0TGlzdGVuZXJzKCk7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTtcclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLk92ZXJsYXkucHJvdG90eXBlLmluaXRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZWwgPSB0aGlzLl9lbG07XHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fdW5jYXRjaEZuKTtcclxuICAgIC8vZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fbW92ZSk7XHJcbiAgICAvL2VsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuX21vdmUpO1xyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuT3ZlcmxheS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICh0aGlzLmlzU2hvd2VkKSB7XHJcbiAgICAgICAgdGhpcy5fZWxtLnN0eWxlWydkaXNwbGF5J10gPSAnbm9uZSc7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZVsndXNlci1zZWxlY3QnXSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pc1Nob3dlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuT3ZlcmxheS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICghdGhpcy5pc1Nob3dlZCkge1xyXG4gICAgICAgIHRoaXMuX2VsbS5zdHlsZVsnZGlzcGxheSddID0gJ2Jsb2NrJztcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlWyd1c2VyLXNlbGVjdCddID0gJ25vbmUnO1xyXG4gICAgICAgIHRoaXMuaXNTaG93ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuT3ZlcmxheS5wcm90b3R5cGUuX3VuY2F0Y2hVbmJpbmRlZEZuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzZWxmLl9zY3JvbGwuaXNDYXRjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgc2VsZi5fdGVtcE1vdXNlUG9zWCA9IHVuZGVmaW5lZDtcclxuICAgICAgICBzZWxmLl90ZW1wTW91c2VQb3NZID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHNlbGYuaGlkZSgpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuT3ZlcmxheS5wcm90b3R5cGUuX21vdmVVbmJpbmRlZEZuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKHNlbGYuaXNTaG93ZWQpIHtcclxuICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gJ21vdXNlbW92ZScpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuX3Njcm9sbC5tb3ZlVG8oZS5jbGllbnRYIC0gc2VsZi5fdGVtcE1vdXNlUG9zWCwgZS5jbGllbnRZIC0gc2VsZi5fdGVtcE1vdXNlUG9zWSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLl90ZW1wTW91c2VQb3NYID0gZS5jbGllbnRYO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5fdGVtcE1vdXNlUG9zWSA9IGUuY2xpZW50WTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZS50eXBlID09PSAndG91Y2htb3ZlJykge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5fc2Nyb2xsLm1vdmVUbyhlLnRvdWNoZXNbMF0uY2xpZW50WCAtIHNlbGYuX3RlbXBNb3VzZVBvc1gsIGUudG91Y2hlc1swXS5jbGllbnRZIC0gc2VsZi5fdGVtcE1vdXNlUG9zWSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLl90ZW1wTW91c2VQb3NYID0gZS50b3VjaGVzWzBdLmNsaWVudFg7XHJcbiAgICAgICAgICAgICAgICBzZWxmLl90ZW1wTW91c2VQb3NZID0gZS50b3VjaGVzWzBdLmNsaWVudFk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07IiwiSW5maW5pdHlTY3JvbGwuTWFwID0gZnVuY3Rpb24gKHNjcmVlbkVsbSwgY29uZmlnUmVmKSB7XHJcbiAgICB0aGlzLndpZHRoID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5oZWlnaHQgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLnBvc1ggPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLnBvc1kgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLmVsbSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuX2NvcGllcyA9IFtdO1xyXG4gICAgdGhpcy5jb25maWcgPSBjb25maWdSZWY7XHJcbiAgICB0aGlzLnNjcmVlbkVsbSA9IHNjcmVlbkVsbTtcclxuICAgIHRoaXMucmVzaXplRm4gPSB0aGlzLnJlc2l6ZVVuYmluZGVkRm4oKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZVNpemVzKCk7XHJcbiAgICB0aGlzLmluaXQoKTtcclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLk1hcC5wcm90b3R5cGUuaW5pdExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnJlc2l6ZUZuKTtcclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLk1hcC5wcm90b3R5cGUudXBkYXRlU2l6ZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2l6ZXMgPSB0aGlzLnNjcmVlbkVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIHRoaXMud2lkdGggPSBzaXplcy53aWR0aDtcclxuICAgIHRoaXMuaGVpZ2h0ID0gc2l6ZXMuaGVpZ2h0O1xyXG4gICAgdGhpcy5wb3NYID0gLXNpemVzLndpZHRoO1xyXG4gICAgdGhpcy5wb3NZID0gLXNpemVzLmhlaWdodDtcclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLk1hcC5wcm90b3R5cGUucmVzaXplVW5iaW5kZWRGbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciB0b1B4ID0gSW5maW5pdHlTY3JvbGwuTWFwLnRvUHg7XHJcbiAgICB2YXIgaXNDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoIWlzQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICBpc0NoYW5nZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlzQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2VsZi51cGRhdGVTaXplcygpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zZXRTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5fY29waWVzXHJcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGNvcHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29weS5zdHlsZVsnd2lkdGgnXSA9IHRvUHgoc2VsZi53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcHkuc3R5bGVbJ2hlaWdodCddID0gdG9QeChzZWxmLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuTWFwLnByb3RvdHlwZS5zZXRQb3NYID0gZnVuY3Rpb24gKHgpIHtcclxuICAgIGlmICghaXNOYU4oeCkgJiYgdGhpcy5jb25maWcuYXhpc1gpIHtcclxuICAgICAgICB0aGlzLnBvc1ggPSB0aGlzLnBvc1ggKyB4O1xyXG4gICAgICAgIHRoaXMucG9zWCA9IHRoaXMucG9zWCA8IDAgPyB0aGlzLnBvc1ggOiAtdGhpcy53aWR0aDtcclxuICAgICAgICB0aGlzLnBvc1ggPSAoMCAtIHRoaXMud2lkdGggKiAyIDwgdGhpcy5wb3NYKSA/IHRoaXMucG9zWCA6IC10aGlzLndpZHRoO1xyXG4gICAgICAgIHRoaXMuZWxtLnN0eWxlWydsZWZ0J10gPSBJbmZpbml0eVNjcm9sbC5NYXAudG9QeCh0aGlzLnBvc1gpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuTWFwLnByb3RvdHlwZS5zZXRQb3NZID0gZnVuY3Rpb24gKHkpIHtcclxuICAgIGlmICghaXNOYU4oeSkgJiYgdGhpcy5jb25maWcuYXhpc1kpIHtcclxuICAgICAgICB0aGlzLnBvc1kgPSB0aGlzLnBvc1kgKyB5O1xyXG4gICAgICAgIHRoaXMucG9zWSA9IHRoaXMucG9zWSA8IDAgPyB0aGlzLnBvc1kgOiAtdGhpcy5oZWlnaHQ7XHJcbiAgICAgICAgdGhpcy5wb3NZID0gKDAgLSB0aGlzLmhlaWdodCAqIDIgPCB0aGlzLnBvc1kpID8gdGhpcy5wb3NZIDogLXRoaXMuaGVpZ2h0O1xyXG5cclxuICAgICAgICB0aGlzLmVsbS5zdHlsZVsndG9wJ10gPSBJbmZpbml0eVNjcm9sbC5NYXAudG9QeCh0aGlzLnBvc1kpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuSW5maW5pdHlTY3JvbGwuTWFwLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHRvUHggPSBJbmZpbml0eVNjcm9sbC5NYXAudG9QeDtcclxuICAgIHZhciBuZWNlc3NhcnlDb3BpZXMgPSAxO1xyXG4gICAgaWYgKHRoaXMuY29uZmlnLmF4aXNYKSB7XHJcbiAgICAgICAgbmVjZXNzYXJ5Q29waWVzICo9IDM7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5jb25maWcuYXhpc1kpIHtcclxuICAgICAgICBuZWNlc3NhcnlDb3BpZXMgKj0gMztcclxuICAgIH1cclxuICAgIHRoaXMuZWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB0aGlzLmVsbS5jbGFzc0xpc3QuYWRkKCdtYXAnKTtcclxuICAgIHRoaXMuZWxtLnN0eWxlWyd1c2VyLXNlbGVjdCddID0gJ25vbmUnO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmVjZXNzYXJ5Q29waWVzOyBpKyspIHtcclxuICAgICAgICB2YXIgY29weSA9IHRoaXMuc2NyZWVuRWxtLmNsb25lTm9kZSh0cnVlKTtcclxuICAgICAgICBjb3B5LnN0eWxlWydmbG9hdCddID0gJ2xlZnQnO1xyXG4gICAgICAgIGNvcHkuc3R5bGVbJ3dpZHRoJ10gPSB0b1B4KHRoaXMud2lkdGgpO1xyXG4gICAgICAgIGNvcHkuc3R5bGVbJ2hlaWdodCddID0gdG9QeCh0aGlzLmhlaWdodCk7XHJcbiAgICAgICAgdGhpcy5lbG0uYXBwZW5kQ2hpbGQoY29weSk7XHJcbiAgICAgICAgdGhpcy5fY29waWVzLnB1c2goY29weSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zY3JlZW5FbG0uaW5uZXJIVE1MID0gXCJcIjtcclxuICAgIHRoaXMuc2NyZWVuRWxtLnN0eWxlWydwb3NpdGlvbiddID0gJ3JlbGF0aXZlJztcclxuICAgIHRoaXMuc2NyZWVuRWxtLnN0eWxlWydvdmVyZmxvdyddID0gJ2hpZGRlbic7XHJcbiAgICB0aGlzLmVsbS5zdHlsZVsncG9zaXRpb24nXSA9ICdhYnNvbHV0ZSc7XHJcbiAgICB0aGlzLnNldFN0YXRlKCk7XHJcbiAgICB0aGlzLmluaXRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuc2NyZWVuRWxtLmFwcGVuZENoaWxkKHRoaXMuZWxtKTtcclxufTtcclxuXHJcbkluZmluaXR5U2Nyb2xsLk1hcC5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgdG9QeCA9IEluZmluaXR5U2Nyb2xsLk1hcC50b1B4O1xyXG4gICAgaWYgKHRoaXMuY29uZmlnLmF4aXNZKSB7XHJcbiAgICAgICAgdGhpcy5lbG0uc3R5bGVbJ2hlaWdodCddID0gdG9QeCh0aGlzLmhlaWdodCAqICh0aGlzLmNvbmZpZy5heGlzWSA/IDMgOiAxKSk7XHJcbiAgICAgICAgdGhpcy5lbG0uc3R5bGVbJ3RvcCddID0gdG9QeCh0aGlzLnBvc1kpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY29uZmlnLmF4aXNYKSB7XHJcbiAgICAgICAgdGhpcy5lbG0uc3R5bGVbJ3dpZHRoJ10gPSB0b1B4KHRoaXMud2lkdGggKiAodGhpcy5jb25maWcuYXhpc1ggPyAzIDogMSkpO1xyXG4gICAgICAgIHRoaXMuZWxtLnN0eWxlWydsZWZ0J10gPSB0b1B4KHRoaXMucG9zWCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5JbmZpbml0eVNjcm9sbC5NYXAudG9QeCA9IGZ1bmN0aW9uIChweCkge1xyXG4gICAgcmV0dXJuIHB4ICsgJ3B4JztcclxufTsiXX0=
